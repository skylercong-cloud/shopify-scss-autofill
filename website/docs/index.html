<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>shopify-scss-autofill · 文档</title>
    <meta
      name="description"
      content="shopify-scss-autofill 文档：Quick Start、指令说明、配置说明。"
    />
    <link
      rel="icon"
      href="https://ctf-1314160455.cos.ap-nanjing.myqcloud.com/favicon.ico"
      type="image/x-icon"
    />
  </head>
  <body>
    <header class="topbar">
      <div class="container topbar__inner">
        <a class="brand" href="../">
          <img
            class="brand__logo"
            src="https://ctf-1314160455.cos.ap-nanjing.myqcloud.com/logo.svg"
            alt=""
            aria-hidden="true"
          />
          <span>shopify-scss-autofill</span>
        </a>
        <nav class="nav">
          <a class="nav__link" href="../">首页</a>
          <a class="nav__link is-active" href="./">文档</a>
          <a
            class="nav__link"
            href="https://github.com/skylercong-cloud/shopify-scss-autofill"
            target="_blank"
            rel="noreferrer"
            >GitHub</a
          >
          <a
            class="nav__link"
            href="https://www.npmjs.com/package/create-shopify-scss-autofill"
            target="_blank"
            rel="noreferrer"
            >npm</a
          >
        </nav>
      </div>
    </header>

    <main class="docs">
      <div class="container docs__layout">
        <aside class="docs__toc" aria-label="目录">
          <div class="toc">
            <div class="toc__title">指南</div>
            <a class="toc__link" href="#overview">介绍</a>
            <a class="toc__link" href="#quick-start">Quick Start</a>
            <a class="toc__link" href="#workflow">工作流</a>
            <a class="toc__link" href="#per-entry">per-entry 覆盖</a>
            <a class="toc__link" href="#override-order">覆盖顺序</a>
            <a class="toc__link" href="#structure">项目结构</a>

            <div class="toc__title">原理</div>
            <a class="toc__link" href="#safety">安全策略</a>
            <a class="toc__link" href="#scss-dev">基于 SCSS 的开发体验</a>
            <a class="toc__link" href="#mobile-min">最小值规则</a>

            <div class="toc__title">参考</div>
            <a class="toc__link" href="#commands">指令大全</a>
            <a class="toc__link" href="#config-yml">config.yml</a>
            <a class="toc__link" href="#config">scss-kit.config.json</a>
            <a class="toc__link" href="#faq">FAQ</a>
          </div>
        </aside>

        <article class="docs__content">
          <h1>shopify-scss-autofill</h1>
          <p class="muted">面向 Shopify Theme Kit 的 SCSS 工具链与文档。</p>

          <section id="overview" class="doc-section">
            <h2>介绍</h2>
            <p>
              目标是把 Theme Kit 的日常样式开发流程变得更稳定：你只需要在
              <span class="code">src/styles</span> 写 SCSS，其余交给工具链。
            </p>
            <ul class="list">
              <li>
                写 SCSS：入口与 partial 都在
                <span class="code">src/styles/</span>
              </li>
              <li>
                安全编译：先输出到
                <span class="code">src/.sass-out</span>，再同步
                <span class="code">assets</span>（降低误覆盖风险）
              </li>
              <li>
                移动端覆盖：从
                <span class="code">r.resp(pc, mobile, type)</span>
                自动生成 per-entry 覆盖文件
              </li>
              <li>
                上传联动：配合
                <span class="code">theme watch</span> 做本地开发上传
              </li>
            </ul>
          </section>

          <section id="quick-start" class="doc-section">
            <h2>Quick Start</h2>
            <ol class="list">
              <li>
                安装/准备：Node.js ≥ 18；本地安装 Shopify Theme Kit（可执行
                <span class="code">theme</span> 命令）。
              </li>
              <li>
                创建工程：
                <div class="codeblock codeblock--terminal">
                  <pre><code>npm create shopify-scss-autofill@latest</code></pre>
                </div>
              </li>
              <li>
                填写 <span class="code">config.yml</span>（Theme Kit 的
                <span class="code">password/theme_id/store</span>）。
              </li>
              <li>
                一键启动：
                <div class="codeblock codeblock--terminal">
                  <pre><code>npm run dev:theme:auto</code></pre>
                </div>
              </li>
            </ol>
          </section>

          <section id="workflow" class="doc-section">
            <h2>工作流</h2>
            <div class="grid">
              <div class="card">
                <h3>写 SCSS</h3>
                <p>
                  在 <span class="code">src/styles/</span> 写入口文件与局部
                  partial。
                </p>
              </div>
              <div class="card">
                <h3>生成移动端覆盖</h3>
                <p>
                  扫描 <span class="code">r.resp(pc, mobile, type)</span>，生成
                  per-entry 覆盖文件。
                </p>
              </div>
              <div class="card">
                <h3>安全编译 + 上传</h3>
                <p>
                  safe watch 输出到
                  <span class="code">src/.sass-out</span> 再同步
                  <span class="code">assets</span>，并由 Theme Kit 上传。
                </p>
              </div>
            </div>
          </section>

          <section id="per-entry" class="doc-section">
            <h2>per-entry 覆盖文件</h2>
            <p class="muted">
              推荐 per-entry：每个入口生成独立覆盖文件，避免不同页面间互相污染。
            </p>
            <p>
              入口文件通常需要在顶部引入生成文件，并在末尾追加覆盖（保证覆盖顺序）。
            </p>
            <div class="codeblock">
              <pre><code>/* src/styles/&lt;page&gt;.scss */
@use "./_responsive-autofill.&lt;page&gt;.generated" as auto;

/* ...你的样式... */

@include auto.responsive_autofill_overrides();</code></pre>
            </div>
          </section>

          <section id="override-order" class="doc-section">
            <h2>覆盖顺序</h2>
            <p class="muted">
              覆盖文件的关键不是“生成了什么”，而是“生成的代码插入在入口 CSS
              的什么位置”。
            </p>

            <ul class="list">
              <li>
                <span class="code"
                  >@include auto.responsive_autofill_overrides()</span
                >
                会把移动端覆盖的 CSS 输出在 <b>include 所在的位置</b>。
              </li>
              <li>
                入口里通常把 include 放在文件末尾：这样生成的 mobile overrides
                会在你的基础样式之后出现（同等选择器优先级下，后者覆盖前者）。
              </li>
              <li>
                如果你需要对生成结果做“手动微调”，推荐把手动 CSS 写在 include
                <b>之后</b>（或用更高的选择器优先级），以确保能覆盖生成代码。
              </li>
              <li>
                未使用
                <span class="code">r.resp</span>
                的声明不会被生成器改写；它们会按你写的原样编译到最终 CSS。
              </li>
            </ul>
          </section>

          <section id="structure" class="doc-section">
            <h2>项目结构</h2>
            <p class="muted">下面是仓库/脚手架中最关键的目录与文件。</p>
            <div class="table">
              <div class="row">
                <div class="cell cmd">src/styles/</div>
                <div class="cell">SCSS 源码（入口 + partial）</div>
              </div>
              <div class="row">
                <div class="cell cmd">assets/</div>
                <div class="cell">编译产物（Theme Kit watch 上传的目标）</div>
              </div>
              <div class="row">
                <div class="cell cmd">tools/scss-kit/</div>
                <div class="cell">
                  内置 CLI + watchers（生成/排查/编译链路）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">scss-kit.config.json</div>
                <div class="cell">扫描目录、entries、阈值等配置</div>
              </div>
              <div class="row">
                <div class="cell cmd">config.yml</div>
                <div class="cell">
                  Theme Kit 连接配置（password/theme_id/store）
                </div>
              </div>
            </div>
          </section>

          <section id="safety" class="doc-section">
            <h2>安全策略</h2>
            <p class="muted">
              工具链默认启用 safe mode：尽量避免把你原有的历史 CSS
              或手工改动“直接覆盖掉”。
            </p>

            <h3 class="doc-subhead">两段式输出</h3>
            <ul class="list">
              <li>
                Sass 编译先输出到
                <span class="code">src/.sass-out/</span>（临时产物）。
              </li>
              <li>
                再由 safe watch 同步到 <span class="code">assets/</span>（Theme
                Kit watch 的上传目标）。
              </li>
            </ul>

            <h3 class="doc-subhead">marker 保护（防误覆盖）</h3>
            <p>
              当 safe watch 试图写入
              <span class="code">assets/*.css</span> 时，只允许覆盖包含
              <span class="code">scss-kit:managed</span> marker
              的既有文件；否则会拒绝覆盖并给出提示。
            </p>

            <h3 class="doc-subhead">冲突写出 .new（兜底）</h3>
            <p>
              生成/初始化阶段如果检测到“无法确认是否为工具产物/无法安全合并”，不会强行改动原文件，而是写出
              <span class="code">*.new</span> 让你手动比对合并。
            </p>
          </section>

          <section id="scss-dev" class="doc-section">
            <h2>基于 SCSS 的开发体验</h2>
            <p class="muted">
              Theme Kit 本质上传的是 CSS，但日常维护更适合写
              SCSS：可读、可组织、可复用。
            </p>

            <h3 class="doc-subhead">你写的是 SCSS</h3>
            <ul class="list">
              <li>
                入口与 partial 统一放在
                <span class="code">src/styles/</span>，用
                <span class="code">@use</span> 做模块化。
              </li>
              <li>
                支持嵌套、变量、函数与拆分文件，让样式更贴近组件结构，减少重复与“复制粘贴改数字”。
              </li>
            </ul>

            <h3 class="doc-subhead">工具链帮你把“响应式 + 覆盖”做成稳定机制</h3>
            <p>
              你在 SCSS 里写
              <span class="code">r.resp(pc, mobile, type)</span>
              来表达“同一语义的 PC / Mobile 值”。
              工具会扫描这些调用并为每个入口生成移动端覆盖（per-entry），而最终上传到
              Shopify 的始终是普通 CSS。
            </p>
          </section>

          <section id="mobile-min" class="doc-section">
            <h2>最小值生成规则</h2>
            <p class="muted">
              这个规则来自生成后的 <span class="code">_responsive.scss</span> 的
              <span class="code">min_px()</span>。
            </p>

            <h3 class="doc-subhead">Typography 最小值（移动端）</h3>
            <ul class="list">
              <li>
                仅对 typography 类型生效：
                <span class="code">h1/h2/h3/body/small/button-text</span>
              </li>
              <li>
                把 750 设计稿的像素值按比例缩放到 375：
                <span class="code">value * (375/750)</span>
              </li>
              <li>
                可读性下限：<span class="code">h1 ≥ 16px</span>、
                <span class="code">h2 ≥ 14px</span>、其他文字
                <span class="code">≥ 12px</span>
              </li>
              <li>并确保最小值不超过设计值（min ≤ max）</li>
            </ul>

            <h3 class="doc-subhead">系数表（兜底）</h3>
            <p class="muted">
              当不走 typography 规则时，会用
              <span class="code">scss-kit.config.json</span> 的系数表：<span
                class="code"
                >coefficients.mobile</span
              >
              / <span class="code">coefficients.desktop</span>。
            </p>
            <div class="codeblock">
              <pre><code>// 例：scss-kit.config.json（节选）
{
  "coefficients": {
    "mobile": {
      "h1": 0.5,
      "h2": 0.625,
      "h3": 0.75,
      "body": 0.857,
      "small": 1,
      "section-gap": 0.5,
      "card-gap": 0.6,
      "element-gap": 0.75,
      "button-text": 1,
      "icon": 0.67
    },
    "desktop": {
      "h1": 0.625,
      "h2": 0.67,
      "h3": 0.75,
      "body": 0.875,
      "small": 1,
      "section-gap": 0.5,
      "card-gap": 0.6,
      "element-gap": 0.67,
      "button-text": 1,
      "icon": 0.625
    }
  }
}</code></pre>
            </div>
          </section>

          <section id="commands" class="doc-section">
            <h2>指令大全</h2>

            <h3>推荐日常指令（npm scripts）</h3>
            <div class="table">
              <div class="row">
                <div class="cell cmd">npm run dev:theme:auto</div>
                <div class="cell">
                  responsive 生成 + safe CSS 编译 + Theme Kit watch
                  上传（开发首选）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">npm run dev:theme</div>
                <div class="cell">
                  仅 safe CSS 编译 + Theme Kit watch（不跑生成器）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">npm run responsive:watch</div>
                <div class="cell">监听 SCSS 变更，触发 per-entry 覆盖生成</div>
              </div>
              <div class="row">
                <div class="cell cmd">npm run scss-kit:init</div>
                <div class="cell">
                  初始化（生成 <span class="code">_responsive.scss</span>、占位
                  autofill 文件、补齐 scripts/devDeps、处理
                  <span class="code">config.yml</span>）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">npm run scss-kit:doctor</div>
                <div class="cell">健康检查（用来确认接入是否完整）</div>
              </div>
              <div class="row">
                <div class="cell cmd">npm run scss-kit:generate</div>
                <div class="cell">
                  仅生成/更新
                  <span class="code">src/styles/_responsive.scss</span>
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">npm run scss-kit:responsive:generate</div>
                <div class="cell">
                  生成响应式覆盖（shared 模式或按配置扫描）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">
                  npm run scss-kit:responsive:generate:entries
                </div>
                <div class="cell">
                  按 <span class="code">autofill.entries</span> 批量生成
                  per-entry 覆盖文件（推荐）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">npm run css:watch</div>
                <div class="cell">
                  safe mode 编译：<span class="code">src/styles</span> →
                  <span class="code">assets</span>
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">npm run theme:watch</div>
                <div class="cell">
                  Theme Kit 上传：<span class="code"
                    >theme watch --env=development</span
                  >
                </div>
              </div>
            </div>

            <h3>scss-kit CLI（工具指令）</h3>
            <p class="muted">
              这些指令来自
              <span class="code">tools/scss-kit/cli.mjs</span
              >，适合初始化、排查与生成。
            </p>
            <div class="table">
              <div class="row">
                <div class="cell cmd">node tools/scss-kit/cli.mjs init</div>
                <div class="cell">
                  初始化：生成
                  <span class="code">_responsive.scss</span
                  >、确保占位生成文件存在、尝试补齐 scripts/devDeps、生成占位
                  <span class="code">config.yml</span>
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">node tools/scss-kit/cli.mjs generate</div>
                <div class="cell">
                  仅生成/更新
                  <span class="code">src/styles/_responsive.scss</span
                  >（安全写入）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">node tools/scss-kit/cli.mjs doctor</div>
                <div class="cell">
                  健康检查：关键文件/配置是否齐全（exit code 表示是否 ok）
                </div>
              </div>
            </div>

            <h3>响应式/覆盖生成（含高级/隐藏用法）</h3>
            <div class="table">
              <div class="row">
                <div class="cell cmd">
                  node tools/scss-kit/cli.mjs responsive:generate
                </div>
                <div class="cell">
                  扫描配置的目录，生成单个 shared 输出（如果你的配置使用 shared
                  模式）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">
                  node tools/scss-kit/cli.mjs responsive:generate
                  &lt;entry.scss&gt;
                </div>
                <div class="cell">
                  （高级）只为一个入口生成 per-entry 覆盖输出（输出路径可选）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">
                  node tools/scss-kit/cli.mjs responsive:generate
                  &lt;entry.scss&gt; &lt;out.scss&gt;
                </div>
                <div class="cell">（高级）指定输出文件路径</div>
              </div>
              <div class="row">
                <div class="cell cmd">
                  node tools/scss-kit/cli.mjs responsive:generate:entries
                </div>
                <div class="cell">
                  （推荐）根据 <span class="code">scss-kit.config.json</span> 的
                  <span class="code">autofill.entries</span> 批量为每个入口生成
                  <span class="code"
                    >_responsive-autofill.&lt;entry&gt;.generated.scss</span
                  >
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">
                  node tools/scss-kit/cli.mjs responsive:extract
                  &lt;file.scss&gt;
                </div>
                <div class="cell">
                  （隐藏）从指定文件提取 px 候选，输出到
                  <span class="code">scss-kit/responsive-extract.json</span>
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">
                  node tools/scss-kit/cli.mjs responsive:template
                </div>
                <div class="cell">
                  （deprecated）旧的 map 模式已移除；该命令会返回错误提示
                </div>
              </div>
            </div>

            <h3>手动兜底（不建议）</h3>
            <div class="codeblock">
              <pre><code>sass --watch src/styles:assets --style=expanded --no-source-map</code></pre>
            </div>
            <p class="muted">
              说明：这会直接覆盖 assets 同名文件，可能误伤历史资源；日常建议使用
              <span class="code">npm run css:watch</span>（safe mode）。
            </p>
          </section>

          <section id="config-yml" class="doc-section">
            <h2>配置说明（config.yml）</h2>
            <p class="muted">
              这是 Theme Kit 的配置文件。最常用的是
              <span class="code">development</span> 环境。
            </p>
            <div class="table">
              <div class="row">
                <div class="cell cmd">development.password</div>
                <div class="cell">Theme Kit API password</div>
              </div>
              <div class="row">
                <div class="cell cmd">development.theme_id</div>
                <div class="cell">主题 ID（Theme ID）</div>
              </div>
              <div class="row">
                <div class="cell cmd">development.store</div>
                <div class="cell">
                  店铺域名（例如 <span class="code">xxx.myshopify.com</span>）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">development.ignore_files</div>
                <div class="cell">Theme Kit watch 忽略上传的文件列表</div>
              </div>
            </div>
            <div class="codeblock">
              <pre><code>development:
  password: "&lt;YOUR_THEMEKIT_PASSWORD&gt;"
  theme_id: "&lt;YOUR_THEME_ID&gt;"
  store: &lt;YOUR_STORE&gt;.myshopify.com
  ignore_files:
    - 'src/**'
    - 'node_modules/**'
    - 'package.json'
    - 'README.md'</code></pre>
            </div>
          </section>

          <section id="config" class="doc-section">
            <h2>配置说明（scss-kit.config.json）</h2>
            <p class="muted">
              本配置受
              <span class="code">tools/scss-kit/schema.json</span> 约束；下面按
              schema 把每一项都列出来。
            </p>

            <div class="table">
              <div class="row">
                <div class="cell cmd">design.desktopWidth</div>
                <div class="cell">PC 设计稿宽度（用于换算与生成注释）</div>
              </div>
              <div class="row">
                <div class="cell cmd">design.mobileWidth</div>
                <div class="cell">移动端设计稿宽度（默认按 750 体系）</div>
              </div>
              <div class="row">
                <div class="cell cmd">design.note</div>
                <div class="cell">备注说明（可选，不影响逻辑）</div>
              </div>

              <div class="row">
                <div class="cell cmd">paths.scssSrcDir</div>
                <div class="cell">
                  SCSS 源目录（一般是 <span class="code">src/styles</span>）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">paths.cssOutDir</div>
                <div class="cell">
                  CSS 输出目录（一般是 <span class="code">assets</span>）
                </div>
              </div>

              <div class="row">
                <div class="cell cmd">autofill.function</div>
                <div class="cell">
                  埋点函数名（默认 <span class="code">r.resp</span>）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">autofill.mobileMax</div>
                <div class="cell">生成移动端覆盖的媒体查询阈值（默认 850）</div>
              </div>
              <div class="row">
                <div class="cell cmd">autofill.scanDirs</div>
                <div class="cell">
                  扫描目录列表（用于寻找 <span class="code">r.resp</span> 调用）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">autofill.output</div>
                <div class="cell">
                  shared 模式的默认输出文件路径（如不使用 shared 可忽略）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">autofill.entries</div>
                <div class="cell">入口列表（per-entry 模式批量生成所需）</div>
              </div>

              <div class="row">
                <div class="cell cmd">themeKit.env</div>
                <div class="cell">
                  Theme Kit 环境名（例如 <span class="code">development</span>）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">themeKit.configYml</div>
                <div class="cell">
                  Theme Kit 配置文件路径（一般是
                  <span class="code">config.yml</span>）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">themeKit.ignoreFiles</div>
                <div class="cell">
                  Theme Kit watch 的 ignore 列表（避免把源码/依赖上传）
                </div>
              </div>

              <div class="row">
                <div class="cell cmd">coefficients.mobile</div>
                <div class="cell">
                  移动端系数表（key 是 type，value 是 number）
                </div>
              </div>
              <div class="row">
                <div class="cell cmd">coefficients.desktop</div>
                <div class="cell">
                  PC 端系数表（key 是 type，value 是 number）
                </div>
              </div>
            </div>
          </section>

          <section id="faq" class="doc-section">
            <h2>FAQ</h2>
            <h3>生成器为什么会产出 <span class="code">*.new</span> 文件？</h3>
            <p>
              这是安全写入策略：当检测到文件不是由工具生成（没有
              marker）时，不会直接覆盖，而是写出
              <span class="code">.new</span> 供你手动合并。
            </p>

            <h3>为什么强调 per-entry？</h3>
            <p>
              per-entry 会为每个入口生成独立覆盖文件，避免 shared generated
              在不同页面之间互相污染。
            </p>
          </section>
        </article>
      </div>
    </main>

    <footer class="footer">
      <div class="container footer__inner">
        <span>MIT License</span>
        <span class="footer__sep">·</span>
        <a
          href="https://github.com/skylercong-cloud/shopify-scss-autofill"
          target="_blank"
          rel="noreferrer"
          >GitHub</a
        >
      </div>
    </footer>

    <script type="module" src="/src/docs.js"></script>
  </body>
</html>
