# scss-kit（本仓库内置工具）

目的：在 Shopify ThemeKit 开发里实现“写 SCSS（src/styles）→ 编译 CSS（assets）→ theme watch 上传”，并提供一套基于 `r.resp(pc, mobile, type)` 的移动端覆盖自动生成能力。

## 拷贝接入（新项目）

把以下内容拷贝到新项目根目录：

- `tools/scss-kit/`
- `scss-kit.config.json`

如果你希望“一条命令脚手架”（内部场景：能访问到本仓库源码），可以在新项目根目录运行：

标准体验（推荐，适用于已发布到 npm 的场景）：

- `npm create shopify-scss-autofill@latest`

内部调试/未发布时（能访问到本仓库源码）：

- `node <path-to-dreame_us>/tools/create-scss-kit/bin/create-scss-kit.mjs .`

然后在新项目根目录执行：

- 先初始化（自动补齐 scripts/devDependencies）：`node tools/scss-kit/cli.mjs init`
- 再安装依赖：`npm install`

初始化后你也可以使用 npm scripts（如果 `package.json` 没有冲突，会被自动补齐）：

- `npm run scss-kit:init`

`scss-kit:init` 会：

- 生成/更新 `src/styles/_responsive.scss`（安全写入：仅当文件包含 `Generated by scss-kit` 才会覆盖，否则写出 `*.new` 供你比对）
- 确保 autofill 生成产物（占位）存在
- 尝试补齐 `package.json` 的 scripts/devDependencies
  - 若发现冲突，不会覆盖原文件，会写到 `scss-kit/patches/package.json.new`
- 处理 `config.yml`
  - 若缺失则创建带占位符的模板（你需要填入 ThemeKit 的 password/theme_id/store）
  - 若已存在但无法安全合并，会写建议块到 `scss-kit/patches/*.new`

## 日常开发

- `npm run dev:theme:auto`
  - 自动生成移动端覆盖（`responsive:watch`）+ 安全编译 CSS（`css:watch`）+ ThemeKit 上传（`theme:watch`）
- `npm run dev:theme`
  - 只做编译 + 上传（不自动跑生成器）

## 移动端覆盖生成（per-entry）

工具会为每个入口 SCSS 生成独立文件，避免跨页面污染：

- 入口：`src/styles/<page>.scss`
- 生成：`src/styles/_responsive-autofill.<page>.generated.scss`

入口文件需要：

- 顶部 `@use "./_responsive-autofill.<page>.generated" as auto;`
- 底部 `@include auto.responsive_autofill_overrides();`（确保覆盖顺序）

## CSS 编译（safe mode）

`npm run css:watch` 默认走 safe mode：

- Sass 先输出到 `src/.sass-out/`
- 再同步到 `assets/`，并阻止覆盖“没有 `scss-kit:managed` marker”的既有 CSS

手动兜底（不建议日常使用，会直接覆盖 assets 同名文件）：

- `sass --watch src/styles:assets --style=expanded --no-source-map`

## 排查

- `npm run scss-kit:doctor`：检查关键文件/配置是否齐全
- 如出现 `.new` / `scss-kit/patches/*.new`：表示工具检测到潜在冲突，避免直接覆盖；请手动比对合并
