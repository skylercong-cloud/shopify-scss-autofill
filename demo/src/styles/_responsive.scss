@use "sass:map";
@use "sass:math";
@use "sass:list";
@use "sass:meta";

// Generated by scss-kit from scss-kit.config.json
// Edit scss-kit.config.json to change design sizes / coefficient tables.

// Design widths:
// - desktop: 1920
// - mobile: 750

$coef-mobile: (  h1: 0.5,
  h2: 0.625,
  h3: 0.75,
  body: 0.857,
  small: 1,
  section-gap: 0.5,
  card-gap: 0.6,
  element-gap: 0.75,
  button-text: 1,
  icon: 0.67,
);

$coef-desktop: (  h1: 0.625,
  h2: 0.67,
  h3: 0.75,
  body: 0.875,
  small: 1,
  section-gap: 0.5,
  card-gap: 0.6,
  element-gap: 0.67,
  button-text: 1,
  icon: 0.625,
);

@function _to-px($value) {
  @return if(math.is-unitless($value), $value * 1px, $value);
}

@function _to-num($value) {
  @if meta.type-of($value) != number {
    @error "Expected a number, got: #{meta.type-of($value)}";
  }
  @if math.is-unitless($value) {
    @return $value;
  }
  @if math.unit($value) != 'px' {
    @error "Expected px or unitless number, got: #{math.unit($value)}";
  }
  @return math.div($value, 1px);
}

@function coef($type, $range: mobile) {
  $table: if($range == desktop, $coef-desktop, $coef-mobile);
  @if map.has-key($table, $type) {
    @return map.get($table, $type);
  }
  @error "Unknown coef type: #{$type}";
}

// 根据 750 稿数值 + 系数，推导 clamp() 的最小值。
@function min_px($mobile, $type, $range: mobile, $override-coef: null) {
  $v: _to-px($mobile);

  // Mobile typography rule:
  // - Scale 750px design to 375px proportion
  // - Apply readable floors: h1>=16px, h2>=14px, other text>=12px
  // - Ensure min <= max (design value)
  @if $range == mobile and $override-coef == null {
    $typography-types: (h1, h2, h3, body, small, button-text);
    @if list.index($typography-types, $type) {
      $scaled-375: $v * math.div(375, 750);
      $floor: if($type == h1, 16px, if($type == h2, 14px, 12px));
      @return math.min($v, math.max($scaled-375, $floor));
    }
  }

  $c: if($override-coef == null, coef($type, $range), $override-coef);
  @return $v * $c;
}

// 生成桌面段 clamp：min + calc(pc * var(--px-to-vw)) + pc
@function clamp_pc($pc, $min) {
  $v: _to-px($pc);
  $n: _to-num($pc);
  @return clamp(#{$min}, calc(#{$n} * var(--px-to-vw)), #{$v});
}

// 生成移动段 clamp：min + calc(mobile * var(--px-to-vw-mb)) + mobile
@function clamp_mb($mobile, $min) {
  $v: _to-px($mobile);
  $n: _to-num($mobile);
  @return clamp(#{$min}, calc(#{$n} * var(--px-to-vw-mb)), #{$v});
}

// resp(): write PC with mobile+type embedded (for scss-kit autofill scanning)
@function resp($pc, $mobile, $type) {
  @if meta.type-of($pc) != number {
    @error "resp() expects a number (px) for pc value";
  }
  @return clamp_pc($pc, min_px($pc, $type, desktop));
}
